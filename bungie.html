<!DOCTYPE html>
<html>
<head>
<script type="text/javascript" src="paper.js"></script>
<script type="text/paperscript" canvas="canvas">

var Particle = Base.extend({
	initialize: function(position, mass) {
		this.position = position;
		this.velocity = new Point(0, 0);
		this.acceleration = new Point(0, 0);
	},

	update: function() {
		this.velocity += this.acceleration;
		this.position += this.velocity;
		this.acceleration *= 0;
		this.velocity *= 0.9;
	},

	applyForce: function(force) {
		this.acceleration += force / 4;
	},

	repel: function(particles, range) {
		for (var i = 0; i < particles.length; i++) {
			var other = particles[i];
			var diff = this.position - other.position;
			var dist = diff.length;
			if (dist < range && dist > 1) {
				diff.length = 1 / (dist * dist)
				other.applyForce(-diff);
			}
		};
	},

	seek: function(target, range) {
		var diff = target.position - this.position;
		var dist = diff.length;
		if (dist > range) {
			diff.length = 1;
			this.applyForce(diff);
		}
	},
});

document.body.style.background = '#000000';
view.zoom = 4;

var particles = [];
var path = new Path({
	strokeColor: '#77EDCF',
	strokeWidth: 3,
	strokeCap: 'round',
});

function addParticle(position) {
	var p = new Particle(position);
	particles.unshift(p);
	path.add(p.position);
}

for (var i = 0; i < 50; i++) {
	addParticle(view.center - new Point(50, 50) + new Point(Math.random() * 100, Math.random() * 100));
}

addParticle(view.center);

function onFrame(event) {
	for (var i = 0; i < particles.length; i++) {
		var p = particles[i];
		if (i > 0) {
			p.seek(particles[i - 1], 10);
			p.repel(particles, 50);
			p.update();
		}
		path.segments[i].point = p.position;
	}
	path.smooth();
}

</script>
</head>
<body>
<canvas id="canvas" resize></canvas>
</body>
</html>
